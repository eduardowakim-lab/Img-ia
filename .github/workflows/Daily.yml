name: Imagem do Dia

on:
  schedule:
    - cron: "0 11 * * *"   # 08:00 America/Sao_Paulo
  workflow_dispatch: {}

jobs:
  run-daily:
    runs-on: ubuntu-latest
    steps:
      - name: Instalar dependências
        run: |
          python -m pip install --upgrade pip requests

      - name: Gerar e enviar imagem (com tratamento de erro)
        run: |
          cat > script.py <<'EOF'
          import os, time, json, base64, requests, smtplib, mimetypes, sys
          from email.message import EmailMessage
          from datetime import datetime, timezone, timedelta

          # ---- Config (com defaults seguros) ----
          OPENAI_API_KEY = os.getenv("OPENAI_API_KEY")
          PROMPT   = os.getenv("PROMPT") or "Um nascer do sol nas montanhas do Brasil, estilo realista"

          # Tamanho (se vier vazio, usa 1024x1024)
          SIZE = os.getenv("IMG_SIZE") or "1024x1024"

          # N_IMAGES (se vier vazio ou inválido, usa 1)
          try:
              N_IMAGES = int(os.getenv("N_IMAGES") or 1)
          except ValueError:
              N_IMAGES = 1

          OUT_NAME = "daily.png"

          SMTP_USER = os.getenv("SMTP_USER")
          SMTP_PASS = os.getenv("SMTP_PASS")
          SMTP_TO   = os.getenv("SMTP_TO")
          SMTP_HOST = os.getenv("SMTP_HOST") or "smtp.gmail.com"
          try:
              SMTP_PORT = int(os.getenv("SMTP_PORT") or 587)
          except ValueError:
              SMTP_PORT = 587

          # Verificação de
